[meta]
id = "crystal-ball"
room_number = 1
title = "The Crystal Ball"
concept = "multiple_readers_ok"

[narrative]
entry = """
The stone stairs spiral downward into darkness. The air grows colder.

You emerge into Level 2: The Borrowing Depths.

Here, data is not just movedâ€”it is SHARED. But sharing has rules...
"""

intro = """
A crystal ball pulses with pale light in the center of the room.

You need the visions it holds, but so do your companions.
Can three adventurers peer into the same orb at once?

The code looks suspicious... but perhaps it works?
Try running it.
"""

success = """
All three of you gaze into the orb simultaneously.
It shows each of you the path ahead. No conflict.

> WORDS OF WISDOM: Multiple read-only borrows (&) can
> coexist. If no one is changing the data, sharing is safe.
>
> Many readers = OK. Writers are where it gets tricky.

A hidden door grinds open. The depths await.
"""

failure_compile = "The orb flickers. Something is wrong..."
failure_output = "The visions are unclear."

hints = [
    "This code might already work. Have you tried running it?",
    "Multiple & references to the same data are allowed.",
    "Press F5 to run. Sometimes the answer is: it just works."
]

[puzzle]
code = '''
fn main() {
    let orb = String::from("The treasure lies below");

    let gaze1 = &orb;
    let gaze2 = &orb;
    let gaze3 = &orb;

    println!("You see: {gaze1}");
    println!("Ally sees: {gaze2}");
    println!("Scout sees: {gaze3}");
}
'''

expected_output = """You see: The treasure lies below
Ally sees: The treasure lies below
Scout sees: The treasure lies below"""

locked_lines = [2, 4, 5, 6, 8, 9, 10]

[scoring]
par_time_seconds = 60
hint_penalty_hp = 5
wrong_answer_penalty_hp = 2

[codex]
title = "Multiple Readers"
description = """
Multiple & references can exist at the same time.
If no one is writing, sharing is safe.

  let orb = String::from("vision");
  let gaze1 = &orb;  // reader 1
  let gaze2 = &orb;  // reader 2
  let gaze3 = &orb;  // reader 3
  // All three can read simultaneously!

Many readers = OK. Writers are where it gets tricky.
"""
