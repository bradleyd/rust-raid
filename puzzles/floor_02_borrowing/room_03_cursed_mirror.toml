[meta]
id = "sealed-door"
room_number = 3
title = "The Sealed Door"
concept = "mutable_references"

[narrative]
entry = """
The gate rises with a thunderous rumble.

Beyond it, a vast chamber opens. Dust motes drift
in shafts of pale light from cracks above.

Something large blocks the far exit...
"""

intro = """
A massive stone door blocks the exit. Ancient runes glow
on its surface: "SEALED"

Your disarm_trap spell can change the runes to "OPENED"...
but the spell consumes whatever it touches! After casting,
the door vanishes completely.

You need a spell that MODIFIES the door, not consumes it.
"""

success = """
The runes shift and change. "SEALED" becomes "OPENED".
The door rumbles aside - still intact, but now passable!

> WORDS OF WISDOM: Use &mut when you need to MODIFY data:
>
>   fn look(s: &str)         - borrow to READ
>   fn change(s: &mut String) - borrow to MODIFY
>   fn consume(s: String)     - take OWNERSHIP (destroy)
>
> &mut = modify in place, caller keeps the data.

Light streams in from beyond. Level 2 complete!
"""

failure_compile = "The spell fizzles. The incantation is wrong..."
failure_output = "The runes flicker but don't change."

hints = [
    "disarm_trap takes ownership (String), but you need the door afterward.",
    "The function MODIFIES the door - it needs &mut, not ownership.",
    "Change 'door: String' to 'door: &mut String', and call with disarm_trap(&mut door)."
]

alternative_solution = "Three ways to pass data: own it (consume), &borrow (read), &mut borrow (modify). Choose based on what the function needs to DO."

[puzzle]
code = '''
fn main() {
    let mut door = String::from("SEALED");

    disarm_trap(door);

    println!("The door reads: {door}");
}

fn disarm_trap(mut door: String) {
    door.clear();
    door.push_str("OPENED");
    println!("*ancient gears grind*");
}
'''

expected_output = """*ancient gears grind*
The door reads: OPENED"""

locked_lines = [2, 6, 10, 11, 12]

[scoring]
par_time_seconds = 180
hint_penalty_hp = 5
wrong_answer_penalty_hp = 2

[codex]
title = "Mutable References"
description = """
Three ways to pass data to a function:

  fn consume(s: String)     // takes ownership
  fn read(s: &String)       // borrows to READ
  fn modify(s: &mut String) // borrows to MODIFY

Use &mut when the function needs to change data
but the caller wants to keep it afterward.

  modify(&mut door);  // door is changed
  println!("{door}"); // door still exists!
"""
